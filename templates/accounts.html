<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>ğŸ“’ Ø¯Ù„ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    :root {
      --bg1:#0d6efd;
      --bg2:#6c63ff;
      --card:#ffffff;
      --ink:#111827;
      --muted:#6b7280;
      --border:#e5e7eb;
      --accent:#0d6efd;
      --danger:#dc2626;
      --success:#16a34a;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: "Tajawal", system-ui, -apple-system, "Segoe UI", sans-serif;
      background: linear-gradient(135deg, var(--bg1), var(--bg2));
      color: var(--ink);
    }

    /* ğŸ” Ø´Ø±ÙŠØ· Ø¹Ù„ÙˆÙŠ Ø«Ø§Ø¨Øª + ØªÙ†Ù‚Ù‘Ù„ Ù…ÙˆØ­Ù‘Ø¯ */
    .top-bar {
      position: fixed;
      top: 0;
      right: 0;
      left: 0;
      z-index: 1000;
      background: rgba(0, 0, 0, 0.25);
      backdrop-filter: blur(8px);
      padding: 10px 16px;
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
    }

    .nav-group {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }

    .nav-btn {
      padding: 7px 14px;
      border-radius: 999px;
      border: none;
      background: #ffffff;
      color: var(--bg1);
      cursor: pointer;
      font-size: 0.85rem;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.25);
      transition: 0.2s ease;
      white-space: nowrap;
    }

    .nav-btn:hover {
      background: var(--bg1);
      color: #fff;
      transform: translateY(-1px);
    }

    .page-title {
      margin: 0;
      font-size: 1rem;
      font-weight: 700;
      flex: 1;
      text-align: center;
      color: #f9fafb;
    }

    @media (max-width: 700px) {
      .page-title {
        font-size: 0.95rem;
      }
    }

    /* ğŸ“¦ Ø§Ù„Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© */
    .container {
      width: 100%;
      max-width: 1100px;
      background: radial-gradient(circle at top left, rgba(255,255,255,0.35), transparent 55%),
                  radial-gradient(circle at bottom right, rgba(15,23,42,0.35), transparent 55%),
                  #0b1120;
      border-radius: 18px;
      padding: 20px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.35);
      color: #f9fafb;
      margin: 80px auto 16px; /* Ù…Ø³Ø§Ø­Ø© ØªØ­Øª Ø§Ù„Ù‡ÙŠØ¯Ø± Ø§Ù„Ø«Ø§Ø¨Øª */
    }

    .header {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 18px;
    }

    .title-group h1 {
      margin: 0;
      font-size: 1.6rem;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .title-group p {
      margin: 4px 0 0;
      font-size: 0.9rem;
      color: #e5e7eb;
    }

    .layout {
      display: grid;
      grid-template-columns: minmax(0, 1.1fr) minmax(0, 1.4fr);
      gap: 18px;
    }

    @media (max-width: 900px) {
      .layout {
        grid-template-columns: 1fr;
      }
    }

    .card {
      background: rgba(15,23,42,0.92);
      border-radius: 14px;
      padding: 16px 16px 14px;
      border: 1px solid rgba(148,163,184,0.4);
      box-shadow: 0 10px 30px rgba(0,0,0,0.4);
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
      gap: 10px;
    }

    .card-header h2 {
      margin: 0;
      font-size: 1rem;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .card-header span.badge {
      padding: 3px 9px;
      border-radius: 999px;
      font-size: 0.75rem;
      background: rgba(37,99,235,0.12);
      border: 1px solid rgba(59,130,246,0.4);
      color: #dbeafe;
    }

    .card-body {
      font-size: 0.9rem;
    }

    label {
      display: block;
      margin-bottom: 4px;
      font-size: 0.85rem;
      color: #e5e7eb;
    }

    .field {
      margin-bottom: 10px;
    }

    input[type="text"],
    select {
      width: 100%;
      padding: 7px 9px;
      border-radius: 9px;
      border: 1px solid rgba(148,163,184,0.6);
      background: rgba(15,23,42,0.9);
      color: #f9fafb;
      font-size: 0.9rem;
      outline: none;
      transition: 0.15s ease;
    }

    input[type="text"]:focus,
    select:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(37,99,235,0.4);
    }

    .hint {
      font-size: 0.78rem;
      color: #9ca3af;
    }

    .field-inline {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 10px;
    }

    @media (max-width: 600px) {
      .field-inline {
        grid-template-columns: 1fr;
      }
    }

    .actions {
      margin-top: 8px;
      display: flex;
      justify-content: flex-start;
      gap: 8px;
      flex-wrap: wrap;
    }

    .btn {
      border-radius: 999px;
      padding: 7px 14px;
      font-size: 0.85rem;
      border: none;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: 0.15s ease;
    }

    .btn-primary {
      background: linear-gradient(135deg, #2563eb, #4f46e5);
      color: white;
      box-shadow: 0 8px 20px rgba(37,99,235,0.4);
    }

    .btn-primary:hover {
      filter: brightness(1.08);
      transform: translateY(-1px);
    }

    .btn-ghost {
      background: transparent;
      color: #e5e7eb;
      border: 1px solid rgba(148,163,184,0.7);
    }

    .btn-ghost:hover {
      background: rgba(15,23,42,0.9);
    }

    .btn-soft {
      background: rgba(15,23,42,0.9);
      color: #e5e7eb;
      border: 1px solid rgba(94,234,212,0.7);
      font-size: 0.8rem;
    }

    .btn-soft:hover {
      background: rgba(45,212,191,0.12);
    }

    .message {
      margin-top: 8px;
      font-size: 0.8rem;
      padding: 6px 9px;
      border-radius: 9px;
      display: none;
    }

    .message.error {
      background: rgba(220,38,38,0.08);
      border: 1px solid rgba(220,38,38,0.8);
      color: #fecaca;
    }

    .message.success {
      background: rgba(22,163,74,0.08);
      border: 1px solid rgba(22,163,74,0.8);
      color: #bbf7d0;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.85rem;
    }

    thead {
      background: rgba(15,23,42,0.95);
    }

    th, td {
      padding: 6px 8px;
      border-bottom: 1px solid rgba(55,65,81,0.7);
      text-align: right;
      white-space: nowrap;
    }

    th {
      font-weight: 600;
      color: #e5e7eb;
      font-size: 0.8rem;
    }

    tbody tr:nth-child(odd) {
      background: rgba(15,23,42,0.75);
    }

    tbody tr:nth-child(even) {
      background: rgba(15,23,42,0.55);
    }

    tbody tr:hover {
      background: rgba(37,99,235,0.22);
    }

    .pill-type {
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 0.75rem;
      border: 1px solid rgba(148,163,184,0.7);
      color: #e5e7eb;
    }

    .pill-type.asset { border-color:#22c55e; color:#bbf7d0; }
    .pill-type.liability { border-color:#f97316; color:#fed7aa; }
    .pill-type.revenue { border-color:#38bdf8; color:#bae6fd; }
    .pill-type.expense { border-color:#f97373; color:#fecaca; }

    .pill-struct {
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 0.75rem;
      border: 1px solid rgba(148,163,184,0.7);
      color: #e5e7eb;
    }

    .pill-struct.group {
      border-color:#eab308;
      color:#fef9c3;
    }

    .pill-struct.detail {
      border-color:#a855f7;
      color:#e9d5ff;
    }

    .tree-name {
      font-family: inherit;
      font-size: 0.85rem;
    }

    .tree-indent {
      opacity: 0.7;
      font-size: 0.78rem;
    }

    .core-star {
      font-size: 0.75rem;
      color: #facc15;
      margin-right: 4px;
    }

    .empty-state {
      text-align: center;
      padding: 12px 4px;
      font-size: 0.85rem;
      color: #9ca3af;
    }

    .badge-count {
      font-size: 0.8rem;
      color: #9ca3af;
    }
  </style>
</head>

<body>
  <!-- ğŸ” Ø§Ù„Ù‡ÙŠØ¯Ø± Ø§Ù„Ø«Ø§Ø¨Øª -->
  <header class="top-bar">
    <div class="nav-group">
      <button class="nav-btn" onclick="location.href='/dashboard'">ğŸ  Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
      <button class="nav-btn" onclick="location.href='/operations'">ğŸ§¾ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</button>
      <button class="nav-btn" onclick="location.href='/receipt'">ğŸ’¸ Ø³Ù†Ø¯Ø§Øª Ø§Ù„ØªØ­ØµÙŠÙ„</button>
      <button class="nav-btn" onclick="location.href='/authorizations'">ğŸ“„ Ø§Ù„ØªÙÙˆÙŠØ¶Ø§Øª</button>
    </div>
    <h1 class="page-title">ğŸ“’ Ø¯Ù„ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª (Chart of Accounts)</h1>
  </header>

  <div class="container">
    <!-- Header Ø¯Ø§Ø®Ù„ Ø§Ù„ÙƒØ§Ø±Øª -->
    <div class="header">
      <div class="title-group">
        <h1>ğŸ“’ Ø¯Ù„ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª</h1>
        <p>
          Ø¥Ø¹Ø¯Ø§Ø¯ Ø´Ø¬Ø±Ø© Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª: Ø£ØµÙˆÙ„ / Ø§Ù„ØªØ²Ø§Ù…Ø§Øª / Ø¥ÙŠØ±Ø§Ø¯ / Ù…ØµØ±ÙˆÙØ§ØªØŒ Ù…Ø¹ Ø¥Ø¨Ø±Ø§Ø² Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ø³Ø§Ø¦Ù‚ÙŠÙ† ÙˆØ§Ù„ØµÙ†Ø¯ÙˆÙ‚ ÙˆØ³Ù„Ù/Ø±Ø³ÙˆÙ… Ø§Ù„Ø³Ø§Ø¦Ù‚ÙŠÙ†
          Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡Ø§ ÙÙŠ Ø¥Ù‚ÙØ§Ù„ Ø§Ù„ØªÙÙˆÙŠØ¶Ø§Øª ÙˆØ³Ù†Ø¯Ø§Øª Ø§Ù„ØªØ­ØµÙŠÙ„.
        </p>
      </div>
    </div>

    <div class="layout">
      <!-- Form card -->
      <div class="card">
        <div class="card-header">
          <h2>â• Ø¥Ø¶Ø§ÙØ© / Ø¨Ù†Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</h2>
          <span class="badge">Ø´Ø¬Ø±Ø© Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª</span>
        </div>
        <div class="card-body">
          <form id="accountForm">
            <div class="field">
              <label for="accName">Ø§Ø³Ù… Ø§Ù„Ø­Ø³Ø§Ø¨</label>
              <input id="accName" type="text" placeholder="Ù…Ø«Ø§Ù„: Ø§Ù„Ø³Ø§Ø¦Ù‚ÙŠÙ† / Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ / Ø³Ù„Ù Ø³Ø§Ø¦Ù‚ÙŠÙ† / Ø±Ø³ÙˆÙ… Ø³Ø§Ø¦Ù‚ÙŠÙ†" />
              <div class="hint">
                Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ø³Ø§Ø¦Ù‚ÙŠÙ†:
                <br>â€¢ <strong>Ø§Ù„Ø³Ø§Ø¦Ù‚ÙŠÙ†</strong> (Ù†ÙˆØ¹: Ø£ØµÙ„ - Ù…Ø¬Ù…ÙˆØ¹Ø©) â† ØªØ­ØªÙ‡Ø§ Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ø³Ø§Ø¦Ù‚ÙŠÙ† Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ©.
                <br>â€¢ <strong>Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚</strong> (Ù†ÙˆØ¹: Ø£ØµÙ„ - ØªÙØµÙŠÙ„ÙŠ) â† Ù„Ù‚ÙŠØ¯ Ø§Ù„ØªØ­ØµÙŠÙ„ Ù…Ù† Ø§Ù„Ø³Ø§Ø¦Ù‚ÙŠÙ†.
                <br>â€¢ <strong>Ø³Ù„Ù Ø³Ø§Ø¦Ù‚ÙŠÙ†</strong> (Ù†ÙˆØ¹: Ø¥ÙŠØ±Ø§Ø¯ - Ù…Ø¬Ù…ÙˆØ¹Ø©) â† Ù„Ù‚ÙŠØ¯ Ø¥Ù‚ÙØ§Ù„ Ø§Ù„ØªÙÙˆÙŠØ¶ Ù…Ù† Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ø³Ø§Ø¦Ù‚ÙŠÙ†.
                <br>â€¢ <strong>Ø±Ø³ÙˆÙ… Ø³Ø§Ø¦Ù‚ÙŠÙ†</strong> (Ù†ÙˆØ¹: Ø§Ù„ØªØ²Ø§Ù… - Ù…Ø¬Ù…ÙˆØ¹Ø©) Ù„Ùˆ Ø§Ø­ØªØ¬Øª Ø±Ø³ÙˆÙ… Ø¥Ø¶Ø§ÙÙŠØ© Ø¹Ù„Ù‰ Ø§Ù„Ø³Ø§Ø¦Ù‚ÙŠÙ†.
              </div>
            </div>

            <div class="field">
              <label for="accType">Ø§Ù„Ù†ÙˆØ¹ Ø§Ù„Ù…Ø­Ø§Ø³Ø¨ÙŠ (ØªØµÙ†ÙŠÙ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù…)</label>
              <select id="accType">
                <option value="">Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ø­Ø³Ø§Ø¨</option>
                <option value="asset">Ø£ØµÙ„ (Asset)</option>
                <option value="liability">Ø§Ù„ØªØ²Ø§Ù… (Liability)</option>
                <option value="revenue">Ø¥ÙŠØ±Ø§Ø¯ (Revenue)</option>
                <option value="expense">Ù…ØµØ±ÙˆÙ (Expense)</option>
              </select>
              <div class="hint">
                Ù…Ø«Ø§Ù„: <strong>Ø§Ù„Ø³Ø§Ø¦Ù‚ÙŠÙ†</strong> Ùˆ <strong>Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚</strong> Ù†ÙˆØ¹Ù‡Ù… "Ø£ØµÙ„" /  
                <strong>Ø³Ù„Ù Ø³Ø§Ø¦Ù‚ÙŠÙ†</strong> Ù†ÙˆØ¹Ù‡ "Ø¥ÙŠØ±Ø§Ø¯" /  
                <strong>Ø±Ø³ÙˆÙ… Ø³Ø§Ø¦Ù‚ÙŠÙ†</strong> Ù†ÙˆØ¹Ù‡ "Ø§Ù„ØªØ²Ø§Ù…".
              </div>
            </div>

            <div class="field-inline">
              <div class="field">
                <label for="parentAccount">Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø£Ø¨ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                <select id="parentAccount">
                  <option value="">Ø¨Ø¯ÙˆÙ† (Ø­Ø³Ø§Ø¨ Ù…Ù† Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø£ÙˆÙ„)</option>
                </select>
                <div class="hint">
                  Ù…Ø«Ø§Ù„: Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø£Ø¨ <strong>"Ø§Ù„Ø³Ø§Ø¦Ù‚ÙŠÙ†"</strong> ÙŠÙƒÙˆÙ† Ø£Ø¨ Ù„Ù€ Ø­Ø³Ø§Ø¨ ØªÙØµÙŠÙ„ÙŠ Ø¨Ø§Ø³Ù… Ø§Ù„Ø³Ø§Ø¦Ù‚
                  Ù…Ø«Ù„: "Ù…Ø­Ù…ÙˆØ¯ Ù…ØµØ·ÙÙ‰".
                </div>
              </div>

              <div class="field">
                <label for="isGroup">Ù‡ÙŠÙƒÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨</label>
                <select id="isGroup">
                  <option value="">Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ù‡ÙŠÙƒÙ„</option>
                  <option value="group">Ø­Ø³Ø§Ø¨ Ø±Ø¦ÙŠØ³ÙŠ / Ù…Ø¬Ù…ÙˆØ¹Ø© (Group)</option>
                  <option value="detail">Ø­Ø³Ø§Ø¨ ØªÙØµÙŠÙ„ÙŠ (Detail)</option>
                </select>
                <div class="hint">
                  â€¢ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ ØªÙÙØªØ­ ØªØ­ØªÙ‡ Ø­Ø³Ø§Ø¨Ø§Øª ÙØ±Ø¹ÙŠØ© (Ù…Ø«Ù„: Ø§Ù„Ø³Ø§Ø¦Ù‚ÙŠÙ†ØŒ Ø³Ù„Ù Ø³Ø§Ø¦Ù‚ÙŠÙ†ØŒ Ø±Ø³ÙˆÙ… Ø³Ø§Ø¦Ù‚ÙŠÙ†).
                  <br>â€¢ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„ØªÙØµÙŠÙ„ÙŠ ÙŠÙØ³ØªØ®Ø¯Ù… Ù…Ø¨Ø§Ø´Ø±Ø© ÙÙŠ Ø§Ù„Ù‚ÙŠÙˆØ¯ (Ù…Ø«Ù„: Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ØŒ Ø§Ù„Ø³Ø§Ø¦Ù‚ ÙÙ„Ø§Ù†).
                </div>
              </div>
            </div>

            <div class="actions">
              <button type="submit" class="btn btn-primary">
                ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø­Ø³Ø§Ø¨
              </button>
              <button type="button" class="btn btn-ghost" id="btnReset">
                â™»ï¸ Ù…Ø³Ø­ Ø§Ù„Ø­Ù‚ÙˆÙ„
              </button>
              <button type="button" class="btn btn-soft" id="btnCreateBase">
                âš™ï¸ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© (Ø§Ù„Ø³Ø§Ø¦Ù‚ÙŠÙ† / Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ / Ø³Ù„Ù / Ø±Ø³ÙˆÙ… Ø³Ø§Ø¦Ù‚ÙŠÙ†)
              </button>
            </div>

            <div id="formMessage" class="message"></div>
          </form>
        </div>
      </div>

      <!-- Table card -->
      <div class="card">
        <div class="card-header">
          <h2>ğŸ“‹ Ø´Ø¬Ø±Ø© Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª</h2>
          <span class="badge-count" id="accountsCount">â€”</span>
        </div>
        <div class="card-body">
          <div style="max-height: 360px; overflow: auto; border-radius: 10px; border: 1px solid rgba(55,65,81,0.7);">
            <table>
              <thead>
                <tr>
                  <th>#</th>
                  <th>Ø§Ø³Ù… Ø§Ù„Ø­Ø³Ø§Ø¨ (Ù‡Ø±Ù…ÙŠ)</th>
                  <th>Ø§Ù„Ù†ÙˆØ¹ Ø§Ù„Ù…Ø­Ø§Ø³Ø¨ÙŠ</th>
                  <th>Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø£Ø¨</th>
                  <th>Ø§Ù„Ù‡ÙŠÙƒÙ„</th>
                  <th>ID Ø¯Ø§Ø®Ù„ÙŠ</th>
                </tr>
              </thead>
              <tbody id="accountsTableBody">
                <tr>
                  <td colspan="6" class="empty-state">
                    Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª...
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="hint" style="margin-top:8px;">
            Ù…Ù„Ø§Ø­Ø¸Ø§Øª:
            <br/>â€¢ ÙŠÙØ¶Ù‘Ù„ ØªØ«Ø¨ÙŠØª Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ÙƒÙ…Ø§ Ù‡ÙŠ:
            <strong>"Ø§Ù„Ø³Ø§Ø¦Ù‚ÙŠÙ†" / "Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚" / "Ø³Ù„Ù Ø³Ø§Ø¦Ù‚ÙŠÙ†" / "Ø±Ø³ÙˆÙ… Ø³Ø§Ø¦Ù‚ÙŠÙ†"</strong>.
            <br/>â€¢ Ù‚ÙŠØ¯ Ø¥Ù‚ÙØ§Ù„ Ø§Ù„ØªÙÙˆÙŠØ¶ Ø§Ù„Ù…Ù‚ØªØ±Ø­: Ù…Ù† <strong>Ø§Ù„Ø³Ø§Ø¦Ù‚ÙŠÙ† / Ø§Ø³Ù… Ø§Ù„Ø³Ø§Ø¦Ù‚</strong> Ø¥Ù„Ù‰ <strong>Ø³Ù„Ù Ø³Ø§Ø¦Ù‚ÙŠÙ†</strong>.
            <br/>â€¢ Ù‚ÙŠØ¯ Ø³Ù†Ø¯ Ø§Ù„ØªØ­ØµÙŠÙ„ Ø§Ù„Ù…Ù‚ØªØ±Ø­: Ù…Ù† <strong>Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚</strong> Ø¥Ù„Ù‰ <strong>Ø§Ù„Ø³Ø§Ø¦Ù‚ÙŠÙ† / Ø§Ø³Ù… Ø§Ù„Ø³Ø§Ø¦Ù‚</strong>.
            <br/>â€¢ ØµÙØ­Ø© Ø§Ù„Ø³Ø§Ø¦Ù‚ÙŠÙ† Ø³ØªÙ†Ø´Ø¦ Ø­Ø³Ø§Ø¨ ØªÙØµÙŠÙ„ÙŠ Ù„ÙƒÙ„ Ø³Ø§Ø¦Ù‚ ØªØ­Øª Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ "Ø§Ù„Ø³Ø§Ø¦Ù‚ÙŠÙ†".
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const form = document.getElementById("accountForm");
    const accNameInput = document.getElementById("accName");
    const accTypeSelect = document.getElementById("accType");
    const parentSelect = document.getElementById("parentAccount");
    const isGroupSelect = document.getElementById("isGroup");
    const formMessage = document.getElementById("formMessage");
    const resetBtn = document.getElementById("btnReset");
    const baseBtn = document.getElementById("btnCreateBase");
    const tableBody = document.getElementById("accountsTableBody");
    const accountsCount = document.getElementById("accountsCount");

    let accountsCache = [];

    function showMessage(text, type = "success") {
      formMessage.textContent = text;
      formMessage.className = "message " + type;
      formMessage.style.display = "block";
    }

    function clearMessage() {
      formMessage.textContent = "";
      formMessage.style.display = "none";
    }

    function typeLabel(type) {
      switch (type) {
        case "asset": return "Ø£ØµÙ„ (Asset)";
        case "liability": return "Ø§Ù„ØªØ²Ø§Ù… (Liability)";
        case "revenue": return "Ø¥ÙŠØ±Ø§Ø¯ (Revenue)";
        case "expense": return "Ù…ØµØ±ÙˆÙ (Expense)";
        default: return type || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯";
      }
    }

    function typePillClass(type) {
      if (!type) return "pill-type";
      return "pill-type " + type;
    }

    function structLabel(is_group) {
      if (is_group === true) return "Ù…Ø¬Ù…ÙˆØ¹Ø© (Group)";
      if (is_group === false) return "ØªÙØµÙŠÙ„ÙŠ (Detail)";
      return "ØºÙŠØ± Ù…Ø­Ø¯Ø¯";
    }

    function structClass(is_group) {
      if (is_group === true) return "pill-struct group";
      if (is_group === false) return "pill-struct detail";
      return "pill-struct";
    }

    function buildAccountsMap(accounts) {
      const map = {};
      (accounts || []).forEach(acc => {
        map[acc.id] = acc;
      });
      return map;
    }

    function getDepth(acc, map, maxDepth = 5) {
      let depth = 0;
      let current = acc;
      while (current && current.parent_id && depth < maxDepth) {
        current = map[current.parent_id];
        depth++;
      }
      return depth;
    }

    function isCoreAccount(acc) {
      if (!acc || !acc.name) return false;
      return (
        acc.name === "Ø§Ù„Ø³Ø§Ø¦Ù‚ÙŠÙ†" ||
        acc.name === "Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚" ||
        acc.name === "Ø³Ù„Ù Ø³Ø§Ø¦Ù‚ÙŠÙ†" ||
        acc.name === "Ø±Ø³ÙˆÙ… Ø³Ø§Ø¦Ù‚ÙŠÙ†"
      );
    }

    function formatTreeName(acc, depth) {
      const indentUnits = "&nbsp;&nbsp;&nbsp;".repeat(depth);
      const branch = depth > 0 ? "<span class='tree-indent'>â†³</span>&nbsp;" : "";
      const core = isCoreAccount(acc)
        ? "<span class='core-star'>â­ Ø­Ø³Ø§Ø¨ Ø£Ø³Ø§Ø³ÙŠ</span>"
        : "";
      return `<span class="tree-name">${indentUnits}${branch}${acc.name}</span> ${core}`;
    }

    async function loadAccounts() {
      try {
        const res = await fetch("/api/accounts");
        if (!res.ok) {
          throw new Error("Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª");
        }
        const data = await res.json();
        accountsCache = data || [];
        renderAccountsTable(accountsCache);
        fillParentSelect(accountsCache);
      } catch (err) {
        console.error(err);
        tableBody.innerHTML = `
          <tr>
            <td colspan="6" class="empty-state">
              âš ï¸ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§ØªØŒ Ø­Ø§ÙˆÙ„ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø©.
            </td>
          </tr>
        `;
        accountsCount.textContent = "Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„";
      }
    }

    function fillParentSelect(accounts) {
      parentSelect.innerHTML = `<option value="">Ø¨Ø¯ÙˆÙ† (Ø­Ø³Ø§Ø¨ Ù…Ù† Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø£ÙˆÙ„)</option>`;
      if (!accounts || accounts.length === 0) return;

      const sorted = [...accounts].sort((a, b) => (a.name || "").localeCompare(b.name || "", "ar"));

      sorted.forEach(acc => {
        const opt = document.createElement("option");
        const typeText = acc.type ? ` - ${typeLabel(acc.type)}` : "";
        const groupText = acc.is_group ? " (Ù…Ø¬Ù…ÙˆØ¹Ø©)" : "";
        opt.value = acc.id;
        opt.innerText = `${acc.name}${typeText}${groupText}`;
        parentSelect.appendChild(opt);
      });
    }

    function renderAccountsTable(accounts) {
      if (!accounts || accounts.length === 0) {
        tableBody.innerHTML = `
          <tr>
            <td colspan="6" class="empty-state">
              Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø³Ø§Ø¨Ø§Øª Ù…Ø³Ø¬Ù‘ÙÙ„Ø© Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†. ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø²Ø± "Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©" Ù„ØªÙ‡ÙŠØ¦Ø© Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ø³Ø§Ø¦Ù‚ÙŠÙ† ÙˆØ§Ù„ØµÙ†Ø¯ÙˆÙ‚ ÙˆØ³Ù„Ù/Ø±Ø³ÙˆÙ… Ø§Ù„Ø³Ø§Ø¦Ù‚ÙŠÙ†.
            </td>
          </tr>
        `;
        accountsCount.textContent = "0 Ø­Ø³Ø§Ø¨";
        return;
      }

      const map = buildAccountsMap(accounts);
      accountsCount.textContent = `${accounts.length} Ø­Ø³Ø§Ø¨/Ø­Ø³Ø§Ø¨Ø§Øª`;

      const sorted = [...accounts].sort((a, b) => {
        const depthA = getDepth(a, map);
        const depthB = getDepth(b, map);
        if (depthA !== depthB) return depthA - depthB;
        return (a.name || "").localeCompare(b.name || "", "ar");
      });

      tableBody.innerHTML = "";
      sorted.forEach((acc, index) => {
        const depth = getDepth(acc, map);
        const parentName = acc.parent_id && map[acc.parent_id] ? map[acc.parent_id].name : " â€” ";

        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${index + 1}</td>
          <td>${formatTreeName(acc, depth)}</td>
          <td><span class="${typePillClass(acc.type)}">${typeLabel(acc.type)}</span></td>
          <td>${parentName}</td>
          <td><span class="${structClass(acc.is_group)}">${structLabel(acc.is_group)}</span></td>
          <td>${acc.id}</td>
        `;
        tableBody.appendChild(tr);
      });
    }

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      clearMessage();

      const name = accNameInput.value.trim();
      const type = accTypeSelect.value;
      let parent_id = parentSelect.value || null;
      const structValue = isGroupSelect.value;

      if (!name) {
        showMessage("Ø§Ø³Ù… Ø§Ù„Ø­Ø³Ø§Ø¨ Ù…Ø·Ù„ÙˆØ¨.", "error");
        return;
      }

      if (!type) {
        showMessage("Ù…Ù† ÙØ¶Ù„Ùƒ Ø§Ø®ØªØ± Ø§Ù„Ù†ÙˆØ¹ Ø§Ù„Ù…Ø­Ø§Ø³Ø¨ÙŠ Ù„Ù„Ø­Ø³Ø§Ø¨.", "error");
        return;
      }

      if (!structValue) {
        showMessage("Ù…Ù† ÙØ¶Ù„Ùƒ Ø§Ø®ØªØ± Ù‡Ù„ Ø§Ù„Ø­Ø³Ø§Ø¨ Ù…Ø¬Ù…ÙˆØ¹Ø© Ø£Ù… ØªÙØµÙŠÙ„ÙŠ.", "error");
        return;
      }

      if (parent_id) {
        parent_id = parseInt(parent_id, 10);
        if (Number.isNaN(parent_id)) {
          parent_id = null;
        }
      }

      let is_group = null;
      if (structValue === "group") is_group = true;
      else if (structValue === "detail") is_group = false;

      try {
        const res = await fetch("/api/accounts", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            name,
            type,
            parent_id,
            is_group
          })
        });

        const data = await res.json();

        if (!res.ok) {
          showMessage(data.error || "Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø­Ø³Ø§Ø¨.", "error");
          return;
        }

        showMessage("âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­.", "success");
        accNameInput.value = "";
        accTypeSelect.value = "";
        parentSelect.value = "";
        isGroupSelect.value = "";
        accNameInput.focus();
        await loadAccounts();
      } catch (err) {
        console.error(err);
        showMessage("âš ï¸ ØªØ¹Ø°Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.", "error");
      }
    });

    resetBtn.addEventListener("click", () => {
      accNameInput.value = "";
      accTypeSelect.value = "";
      parentSelect.value = "";
      isGroupSelect.value = "";
      clearMessage();
      accNameInput.focus();
    });

    baseBtn.addEventListener("click", async () => {
      clearMessage();

      if (!accountsCache || accountsCache.length === 0) {
        showMessage("â³ Ø³ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ø§Ù„Ø¢Ù†...", "success");
      } else {
        showMessage("â³ ÙŠØªÙ… ÙØ­Øµ ÙˆØ¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ø§Ù„Ù†Ø§Ù‚ØµØ©...", "success");
      }

      const needed = [
        { name: "Ø§Ù„Ø³Ø§Ø¦Ù‚ÙŠÙ†", type: "asset", is_group: true, parent_id: null },
        { name: "Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚", type: "asset", is_group: false, parent_id: null },
        { name: "Ø³Ù„Ù Ø³Ø§Ø¦Ù‚ÙŠÙ†", type: "revenue", is_group: true, parent_id: null },
        { name: "Ø±Ø³ÙˆÙ… Ø³Ø§Ø¦Ù‚ÙŠÙ†", type: "liability", is_group: true, parent_id: null }
      ];

      const existing = (accountsCache || []);
      const toCreate = needed.filter(n =>
        !existing.some(a => a.name === n.name && a.type === n.type)
      );

      if (toCreate.length === 0) {
        showMessage("âœ… ÙƒÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ù…ÙˆØ¬ÙˆØ¯Ø© Ø¨Ø§Ù„ÙØ¹Ù„.", "success");
        return;
      }

      try {
        for (const acc of toCreate) {
          await fetch("/api/accounts", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(acc)
          });
        }
        showMessage("âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡/Ø§Ø³ØªÙƒÙ…Ø§Ù„ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­.", "success");
        await loadAccounts();
      } catch (err) {
        console.error(err);
        showMessage("âš ï¸ ØªØ¹Ø°Ø± Ø¥Ù†Ø´Ø§Ø¡ Ø¨Ø¹Ø¶ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©ØŒ ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ±.", "error");
      }
    });

    // Ø£ÙˆÙ„ Ù…Ø§ Ø§Ù„ØµÙØ­Ø© ØªÙØªØ­
    loadAccounts();
  </script>
             <script>
            // ğŸ”’ Ù…Ù†Ø¹ ÙƒÙ„ÙŠÙƒ ÙŠÙ…ÙŠÙ†
            document.addEventListener('contextmenu', function (e) {
              e.preventDefault();
            });
          
            // ğŸ”’ Ù…Ù†Ø¹ Ù…ÙØ§ØªÙŠØ­ Ø§Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ø´Ù‡ÙˆØ±Ø© Ù„Ù„Ù…Ø·ÙˆØ±ÙŠÙ†
            document.addEventListener('keydown', function (e) {
              // F12
              if (e.key === "F12") {
                e.preventDefault();
              }
          
              // Ctrl + Shift + I Ø£Ùˆ Ctrl + Shift + J Ø£Ùˆ Ctrl + U
              if ((e.ctrlKey && e.shiftKey && (e.key === 'I' || e.key === 'J')) || 
                  (e.ctrlKey && e.key === 'U')) {
                e.preventDefault();
              }
            });
          </script>
</body>
</html>



